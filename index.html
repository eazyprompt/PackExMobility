<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
  />
  <title>PackEx</title>

  <link rel="icon" type="image/png" sizes="32x32" href="/PackExMobility/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/PackExMobility/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/PackExMobility/icon-180.png">
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#020617">

  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=JetBrains+Mono:wght@500;700;800&display=swap"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.321.0/dist/umd/lucide.min.js"></script>

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="app-frame">
    <header>
      <div class="brand"><i data-lucide="scan-face"></i> PackEx <span>Mobility</span></div>
      <div class="header-controls">
        <div id="ctl-color-algo">
          <select id="algo-select" class="algo-selector" onchange="changeMode(this.value)">
            <option value="2000">DE 2000</option>
            <option value="94">DE 94</option>
            <option value="76">DE 76</option>
          </select>
        </div>
        <button class="btn-icon-header" id="btn-torch" onclick="toggleTorchHold()" title="Torch">
          <i data-lucide="flashlight" style="width: 18px;"></i>
        </button>
      </div>
    </header>

    <div class="viewport">
      <div class="vp-camera" id="vp-camera">
        <video id="webcam" autoplay playsinline muted></video>
        <img id="ghost-overlay" class="ghost-overlay" src="" alt="Ghost Reference" />
        <canvas id="sheet-canvas"></canvas>

        <div class="lightctl" id="lightctl">
          <div class="lightctl-head">
            <i data-lucide="sun-medium" class="lightctl-ico"></i>
            <span class="lightctl-title">LIGHT</span>
          </div>
          <div class="lightctl-rail">
            <input id="light-slider" class="lightctl-slider" type="range" min="-30" max="30" step="1" value="0">
            <div class="lightctl-value" id="light-val">0</div>
          </div>
          <button class="lightctl-auto" id="light-auto" type="button" onclick="toggleLightAuto()">AUTO</button>
          <button class="lightctl-reset" id="light-reset" type="button" onclick="resetLightBias()" title="Reset">
            <i data-lucide="rotate-ccw" style="width:16px; height:16px;"></i>
          </button>
        </div>

        <div class="hud-overlay">
          <div id="target-box" class="target-box">
            <div class="crosshair"><div class="ch-c"></div></div>
          </div>
        </div>
      </div>

      <div class="vp-side-panel" id="vp-side-panel">
        <div id="side-colex">
          <div class="vp-header"><i data-lucide="bot" style="width: 14px;"></i> AI ASSIST</div>
          <div id="advice-content"></div>
          <div id="advice-placeholder" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; opacity:0.35; text-align:center; gap:10px; color:#94a3b8;">
            <i data-lucide="scan" style="width: 28px; opacity: 0.55;"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-content">
        
        <div id="panel-colex" style="display:flex; flex-direction:column; gap:var(--gap-layout); padding: 0 20px; padding-top:10px;">
          <div id="result-dashboard" class="result-dashboard">
            <div class="res-left">
              <div class="res-label">Delta E <span id="algo-lbl">2000</span></div>
              <div class="res-value" id="delta-val">--</div>
            </div>
            <div class="dash-right" style="display:flex; align-items:center; gap:10px;">
              <div class="res-badge" id="delta-msg">READY</div>
              <button class="btn-icon-header" onclick="resetAll()" title="Reset">
                <i data-lucide="rotate-cw" style="width: 18px;"></i>
              </button>
            </div>
          </div>

          <div class="cards-container">
            <div class="data-card" id="card-ref">
              <div class="card-top">
                <div style="font-size:0.75rem; font-weight:800; color:var(--text-muted); display:flex; gap:6px; align-items:center;"><i data-lucide="crosshair" width="14"></i> REF</div>
                <div class="color-dot" id="preview-ref"></div>
              </div>
              <div class="lab-row">
                <div class="l-item"><div class="l-lbl">L</div><div class="l-val" id="ref-l">-</div></div>
                <div class="l-item"><div class="l-lbl">a</div><div class="l-val" id="ref-a">-</div></div>
                <div class="l-item"><div class="l-lbl">b</div><div class="l-val" id="ref-b">-</div></div>
              </div>
              <button class="btn-act" id="btn-lock-ref" onclick="lockRef()">
                <i data-lucide="fingerprint" style="width: 16px;"></i> CAPTURE
              </button>
            </div>

            <div class="data-card" id="card-sam">
              <div class="card-top">
                <div style="font-size:0.75rem; font-weight:800; color:var(--text-muted); display:flex; gap:6px; align-items:center;"><i data-lucide="zap" width="14"></i> SAMPLE</div>
                <div class="color-dot" id="preview-sam"></div>
              </div>
              <div class="lab-row">
                <div class="l-item"><div class="l-lbl">L</div><div class="l-val" id="sam-l">-</div></div>
                <div class="l-item"><div class="l-lbl">a</div><div class="l-val" id="sam-a">-</div></div>
                <div class="l-item"><div class="l-lbl">b</div><div class="l-val" id="sam-b">-</div></div>
              </div>
              <button class="btn-act" id="btn-lock-sam" onclick="lockSam()">
                <i data-lucide="scan-line" style="width: 16px;"></i> CAPTURE
              </button>
            </div>
          </div>

          <div class="viz-section">
            <div class="graph-box">
              <div class="plot-legend">
                <div class="legend-item"><div class="dot-icon di-ref"></div> REF</div>
                <div class="legend-item"><div class="dot-icon di-sam"></div> SAM</div>
              </div>
              <div class="axis-lbl ax-t">+b Yel</div>
              <div class="axis-lbl ax-b">-b Blu</div>
              <div class="axis-lbl ax-l">-a Grn</div>
              <div class="axis-lbl ax-r">+a Red</div>
              <canvas id="ab-plot"></canvas>
            </div>
            <div class="l-bar-box">
              <div style="font-size: 0.5rem; color: #64748b; font-weight: 700;">L*</div>
              <div class="l-track">
                <div id="marker-ref" class="l-mark ref"></div>
                <div id="marker-sam" class="l-mark sam"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="panel-gluegap" class="display-none" style="height:100%; width:100%;">
          <div class="glue-dashboard">
            <div class="glue-compact-header" id="glue-header">
              <div class="gc-left" id="header-status-group">
                <div class="gc-status-badge"><i data-lucide="minus"></i> READY</div>
              </div>
              <div class="gc-right">
                <button id="btn-sheet-cap" class="btn-header-cap" onclick="toggleSheetCapture()">
                  <i data-lucide="camera"></i>
                </button>
              </div>
            </div>

            <div class="glue-body-split">
              <div class="glue-main-area" id="layer-list-cont">
                <div class="glue-list-header" id="stats-header" style="display:none;"></div>
                <div class="dist-container" id="dist-wrapper">
                  <canvas id="dist-canvas"></canvas>
                  <div id="empty-scan-msg" style="position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; color:#475569; gap:10px;">
                    <i data-lucide="scan-line" width="32"></i>
                    <span style="font-size:0.75rem;">Align camera to scan</span>
                  </div>
                </div>
              </div>

              <div class="glue-summary-area">
                <div class="sum-item">
                  <div class="sum-val" id="sum-total">0</div>
                  <div class="sum-lbl">Box Found</div>
                </div>
                <div class="sum-item">
                  <div class="sum-val text-ok" id="sum-gap">0</div>
                  <div class="sum-lbl">NORMAL GAP</div>
                </div>
                <div class="sum-item">
                  <div class="sum-val text-ng" id="sum-red">0</div>
                  <div class="sum-lbl">WARNING GAP</div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="tab-bar">
      <div class="tab-item active" id="tab-colex" onclick="switchTab('colex')">
        <i data-lucide="palette"></i>
        <span class="tab-lbl">COLEX</span>
      </div>
      <div class="tab-item" id="tab-gluegap" onclick="switchTab('gluegap')">
        <i data-lucide="layers"></i>
        <span class="tab-lbl">GLUE GAP</span>
      </div>
    </div>
  </div>

  <canvas id="proc-canvas" width="100" height="100"></canvas>

  <script src="script.js"></script>
</body>
</html>